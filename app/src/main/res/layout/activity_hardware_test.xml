<?xml version="1.0" encoding="utf-8"?>
<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:padding="16dp"
    android:background="#f5f5f5">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical">

        <!-- Header -->
        <TextView
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="PUDO Kiosk Hardware Test Center"
            android:textSize="20sp"
            android:textStyle="bold"
            android:textColor="#2E7D32"
            android:gravity="center"
            android:layout_marginBottom="24dp"
            android:background="#E8F5E8"
            android:padding="12dp" />

        <!-- ===== PRINTER TESTING SECTION (NEW CUSTOM API) ===== -->
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:background="#ffffff"
            android:padding="16dp"
            android:layout_marginBottom="16dp"
            android:elevation="2dp">

            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="🖨️ Thermal Printer (Custom TG2480HIII)"
                android:textStyle="bold"
                android:textSize="18sp"
                android:textColor="#1976D2"
                android:layout_marginBottom="8dp" />

            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Manufacturer API integration - Enhanced reliability and features"
                android:textSize="12sp"
                android:textColor="#666666"
                android:layout_marginBottom="12dp" />

            <!-- Connection Status Display -->
            <TextView
                android:id="@+id/tvPrinterStatus"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="⚪ Printer Status: Initializing..."
                android:textSize="14sp"
                android:textStyle="bold"
                android:padding="12dp"
                android:background="#F0F0F0"
                android:layout_marginBottom="8dp" />

            <!-- Detailed Status Display -->
            <TextView
                android:id="@+id/tvPrinterDetails"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Ready: ? | Paper: ? | Cover: ? | Temp: ?"
                android:textSize="12sp"
                android:padding="8dp"
                android:background="#FAFAFA"
                android:layout_marginBottom="16dp" />

            <!-- Primary Test Buttons -->
            <LinearLayout
                android:orientation="horizontal"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginBottom="8dp">

                <Button
                    android:id="@+id/btnPrintTest"
                    android:layout_weight="1"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:text="Print Test Page"
                    android:background="#4CAF50"
                    android:textColor="#FFFFFF"
                    android:layout_marginEnd="4dp" />

                <Button
                    android:id="@+id/btnPrinterStatus"
                    android:layout_weight="1"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:text="Check Status"
                    android:background="#2196F3"
                    android:textColor="#FFFFFF"
                    android:layout_marginStart="4dp" />

                <Button
                    android:id="@+id/btnDebugConnection"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:text="🔍 Run Debug Session"
                    android:background="#9C27B0"
                    android:textColor="#FFFFFF"
                    android:layout_marginTop="8dp" />

                <Button
                    android:id="@+id/btnProtocolSwitch"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:text="🔄 Test Protocols"
                    android:background="#607D8B"
                    android:textColor="#FFFFFF"
                    android:layout_marginTop="4dp" />

                <TextView
                    android:id="@+id/tvProtocolInfo"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:text="🔗 Protocol: Detecting..."
                    android:textSize="12sp"
                    android:padding="8dp"
                    android:background="#E3F2FD"
                    android:layout_marginTop="8dp" />
            </LinearLayout>

            <!-- Advanced Test Buttons -->
            <LinearLayout
                android:orientation="horizontal"
                android:layout_width="match_parent"
                android:layout_height="wrap_content">

                <Button
                    android:id="@+id/btnPrintReceipt"
                    android:layout_weight="1"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:text="Print Receipt"
                    android:background="#FF9800"
                    android:textColor="#FFFFFF"
                    android:layout_marginEnd="4dp" />

                <Button
                    android:id="@+id/btnPrintBarcode"
                    android:layout_weight="1"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:text="Print Barcodes"
                    android:background="#9C27B0"
                    android:textColor="#FFFFFF"
                    android:layout_marginStart="4dp" />
            </LinearLayout>

        </LinearLayout>

        <!-- Section Divider -->
        <View
            android:layout_width="match_parent"
            android:layout_height="1dp"
            android:background="#E0E0E0"
            android:layout_marginVertical="8dp" />

        <!-- ===== SERIAL COMMUNICATION SECTION ===== -->
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:background="#ffffff"
            android:padding="16dp"
            android:layout_marginBottom="16dp"
            android:elevation="2dp">

            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="🔌 Serial Communication (RS232/RS485)"
                android:textStyle="bold"
                android:textSize="18sp"
                android:textColor="#1976D2"
                android:layout_marginBottom="12dp" />

            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="For MDB board and locker control communication"
                android:textSize="12sp"
                android:textColor="#666666"
                android:layout_marginBottom="12dp" />

            <Spinner
                android:id="@+id/spSerial"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginBottom="8dp" />

            <Spinner
                android:id="@+id/spBaud"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginBottom="12dp" />

            <LinearLayout
                android:orientation="horizontal"
                android:layout_width="match_parent"
                android:layout_height="wrap_content">

                <Button
                    android:id="@+id/btnOpenSerial"
                    android:layout_weight="1"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:text="Open Serial"
                    android:background="#4CAF50"
                    android:textColor="#FFFFFF"
                    android:layout_marginEnd="4dp" />

                <Button
                    android:id="@+id/btnSendProbe"
                    android:layout_weight="1"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:text="Send Probe"
                    android:background="#2196F3"
                    android:textColor="#FFFFFF"
                    android:layout_marginStart="4dp" />
            </LinearLayout>

        </LinearLayout>

        <!-- ===== LOCKER CONTROL SECTION ===== -->
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:background="#ffffff"
            android:padding="16dp"
            android:layout_marginBottom="16dp"
            android:elevation="2dp">

            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="🔐 Locker Control (STM32L412 via RS485)"
                android:textStyle="bold"
                android:textSize="18sp"
                android:textColor="#1976D2"
                android:layout_marginBottom="12dp" />

            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="9600 baud, 8N1 - Station &amp; lock configuration"
                android:textSize="12sp"
                android:textColor="#666666"
                android:layout_marginBottom="12dp" />

            <LinearLayout
                android:orientation="horizontal"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginBottom="12dp">

                <EditText
                    android:id="@+id/etStation"
                    android:layout_weight="1"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:hint="Station #"
                    android:inputType="number"
                    android:text="1"
                    android:layout_marginEnd="8dp" />

                <EditText
                    android:id="@+id/etLock"
                    android:layout_weight="1"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:hint="Lock #"
                    android:inputType="number"
                    android:text="1"
                    android:layout_marginStart="8dp" />
            </LinearLayout>

            <LinearLayout
                android:orientation="horizontal"
                android:layout_width="match_parent"
                android:layout_height="wrap_content">

                <Button
                    android:id="@+id/btnOpenLocker"
                    android:layout_weight="1"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:text="Open Locker"
                    android:background="#4CAF50"
                    android:textColor="#FFFFFF"
                    android:layout_marginEnd="4dp" />

                <Button
                    android:id="@+id/btnCheckLocker"
                    android:layout_weight="1"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:text="Check Status"
                    android:background="#2196F3"
                    android:textColor="#FFFFFF"
                    android:layout_marginStart="4dp" />
            </LinearLayout>

        </LinearLayout>

        <!-- ===== BARCODE SCANNER SECTION (ENHANCED) ===== -->
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:background="#ffffff"
            android:padding="16dp"
            android:layout_marginBottom="16dp"
            android:elevation="2dp">

            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="📱 Barcode Scanner (Honeywell Xenon 1900)"
                android:textStyle="bold"
                android:textSize="18sp"
                android:textColor="#1976D2"
                android:layout_marginBottom="12dp" />

            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="15-pin SUB-D to RS232 converter cable → Direct RS232 connection"
                android:textSize="12sp"
                android:textColor="#666666"
                android:layout_marginBottom="12dp" />

            <!-- Scanner Status Display -->
            <TextView
                android:id="@+id/tvScannerStatus"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="⚪ Scanner status: Initializing..."
                android:textSize="12sp"
                android:textColor="#FF9800"
                android:background="#FFF8E1"
                android:padding="8dp"
                android:layout_marginBottom="12dp" />

            <!-- Control Buttons Row -->
            <LinearLayout
                android:orientation="horizontal"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginBottom="8dp">

                <Button
                    android:id="@+id/btnScannerFocus"
                    android:layout_weight="1"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:text="Focus Input"
                    android:background="#FF9800"
                    android:textColor="#FFFFFF"
                    android:layout_marginEnd="4dp" />

                <Button
                    android:id="@+id/btnTriggerScan"
                    android:layout_weight="1"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:text="📸 Trigger Scan"
                    android:background="#4CAF50"
                    android:textColor="#FFFFFF"
                    android:layout_marginStart="4dp"
                    android:enabled="false" />

            </LinearLayout>

            <!-- Additional Control Buttons Row -->
            <LinearLayout
                android:orientation="horizontal"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginBottom="8dp">

                <Button
                    android:id="@+id/btnTestConnection"
                    android:layout_weight="1"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:text="Test Connection"
                    android:background="#2196F3"
                    android:textColor="#FFFFFF"
                    android:layout_marginEnd="4dp" />

                <Button
                    android:id="@+id/btnClearScans"
                    android:layout_weight="1"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:text="Clear Results"
                    android:background="#9E9E9E"
                    android:textColor="#FFFFFF"
                    android:layout_marginStart="4dp" />

            </LinearLayout>

            <!-- Diagnostic and Help Buttons Row -->
            <LinearLayout
                android:orientation="horizontal"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginBottom="12dp">

                <Button
                    android:id="@+id/btnRunDiagnostics"
                    android:layout_weight="1"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:text="🔍 Run RS232 Diagnostics"
                    android:background="#9C27B0"
                    android:textColor="#FFFFFF"
                    android:layout_marginEnd="4dp" />

                <Button
                    android:id="@+id/btnHardwareHelp"
                    android:layout_weight="1"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:text="📋 Hardware Help"
                    android:background="#607D8B"
                    android:textColor="#FFFFFF"
                    android:layout_marginStart="4dp" />

            </LinearLayout>

            <!-- Instructions -->
            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="📋 Instructions:\n• Press 'Trigger Scan' to activate scanner via RS232\n• Point scanner at barcode and pull physical trigger\n• Results appear below with timestamp\n• Run diagnostics if connection fails"
                android:textSize="11sp"
                android:textColor="#757575"
                android:background="#F5F5F5"
                android:padding="8dp"
                android:layout_marginBottom="8dp" />

            <!-- Scanned Results Display -->
            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="📸 Scanned Results:"
                android:textStyle="bold"
                android:textSize="14sp"
                android:textColor="#1976D2"
                android:layout_marginBottom="4dp" />

            <EditText
                android:id="@+id/etScannerSink"
                android:layout_width="match_parent"
                android:layout_height="150dp"
                android:gravity="top"
                android:hint="Scanned barcodes will appear here with timestamps...\n\nClick 'Trigger Scan' to start scanning.\n\nIf connection fails, run 'RS232 Diagnostics' for troubleshooting."
                android:inputType="textMultiLine"
                android:background="#F8F8F8"
                android:padding="12dp"
                android:textSize="12sp"
                android:scrollbars="vertical"
                android:fontFamily="monospace" />

            <!-- Connection Info (Optional Debug Info) -->
            <TextView
                android:id="@+id/tvConnectionInfo"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="🔌 Connection: Checking USB devices..."
                android:textSize="10sp"
                android:textColor="#9E9E9E"
                android:layout_marginTop="8dp"
                android:visibility="gone" />

        </LinearLayout>

        <!-- ===== PAYMENT TERMINAL SECTION ===== -->
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:background="#ffffff"
            android:padding="16dp"
            android:layout_marginBottom="16dp"
            android:elevation="2dp">

            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="💳 Payment Terminal (PAX IM30 via MDB)"
                android:textStyle="bold"
                android:textSize="18sp"
                android:textColor="#1976D2"
                android:layout_marginBottom="12dp" />

            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Connected via custom MDB board over RS232"
                android:textSize="12sp"
                android:textColor="#666666"
                android:layout_marginBottom="12dp" />

            <LinearLayout
                android:orientation="horizontal"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginBottom="12dp">

                <EditText
                    android:id="@+id/etPaymentAmount"
                    android:layout_weight="1"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:hint="Amount (cents)"
                    android:inputType="number"
                    android:text="500"
                    android:layout_marginEnd="8dp" />

                <Button
                    android:id="@+id/btnTestPayment"
                    android:layout_weight="1"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:text="Test Payment"
                    android:background="#4CAF50"
                    android:textColor="#FFFFFF"
                    android:layout_marginStart="8dp" />
            </LinearLayout>

            <TextView
                android:id="@+id/tvPaymentStatus"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Payment Status: Not connected"
                android:textSize="12sp"
                android:padding="8dp"
                android:background="#F0F0F0" />

        </LinearLayout>

        <!-- ===== SYSTEM INFORMATION SECTION ===== -->
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:background="#ffffff"
            android:padding="16dp"
            android:layout_marginBottom="16dp"
            android:elevation="2dp">

            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="ℹ️ System Information"
                android:textStyle="bold"
                android:textSize="18sp"
                android:textColor="#1976D2"
                android:layout_marginBottom="12dp" />

            <TextView
                android:id="@+id/tvSystemInfo"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Hardware: IoT3288A V1.311\nAndroid: 7.1.2 (API 25)\nArchitecture: ARM\nManufacturer APIs: Custom, Honeywell"
                android:textSize="12sp"
                android:padding="12dp"
                android:background="#F8F8F8"
                android:fontFamily="monospace" />

        </LinearLayout>

        <!-- ===== CLEAR ALL / RESET SECTION ===== -->
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:layout_marginTop="16dp">

            <Button
                android:id="@+id/btnClearLogs"
                android:layout_weight="1"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:text="Clear All Logs"
                android:background="#FF5722"
                android:textColor="#FFFFFF"
                android:layout_marginEnd="8dp" />

            <Button
                android:id="@+id/btnResetAll"
                android:layout_weight="1"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:text="Reset All Hardware"
                android:background="#607D8B"
                android:textColor="#FFFFFF"
                android:layout_marginStart="8dp" />

        </LinearLayout>

        <!-- Footer spacer -->
        <View
            android:layout_width="match_parent"
            android:layout_height="32dp" />

    </LinearLayout>
</ScrollView>